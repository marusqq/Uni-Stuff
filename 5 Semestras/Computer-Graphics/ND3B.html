<!DOCTYPE html>

<html>

<head>
    <title>ND3B</title>
	<script type="text/javascript" src="./libs/three.min.js"></script>
    <script type="text/javascript" src="./libs/jquery-1.9.0.js"></script>
    <script type="text/javascript" src="./libs/stats.js"></script>
    <script type="text/javascript" src="./libs/dat.gui.js"></script>
    <script type="text/javascript" src="./libs/TrackballControls.js"></script>
	   <script type="text/javascript" src="./libs/KeyboardState.js"></script>

    <style>
        body{
            /* set margin to 0 and overflow to hidden, to go fullscreen */
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
<div id="Stats-output">
</div>
<!-- Div which will hold the Output -->
<div id="WebGL-output">
</div>

<!-- Javascript code that runs our Three.js examples -->
<script type="text/javascript">

	 // global variables
    var renderer;
    var scene;
    var camera1;
	var camera2;
	var camObject;
	var controls;
	var keyboard = new KeyboardState();
	var pav;
	var i;
	var c2;
	var c3;
    var zoomCount = 100;
	var dollyZoomCount;
    // once everything is loaded, we run our Three.js stuff.
    function init() {

		scene = new THREE.Scene();

    console.log(scene)

		camera1 = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
		camera1.position.x = -30;
		camera1.position.y = 40;
		camera1.position.z = 30;
		//camera1.lookAt(scene.position);

		camera2 = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera2.position.x = 0;
        camera2.position.y = 20;
        camera2.position.z = -14.1;
        //camera2.lookAt(scene.position);

		camera3 = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera3.position.x = -30;
        camera3.position.y = 8;
        camera3.position.z = -2;

        renderer = new THREE.WebGLRenderer();
		    renderer.setClearColor(0x00000, 1.0);
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMapEnabled = true;

        var ambientLight = new THREE.AmbientLight(0x0c0c0c);
        //scene.add(ambientLight);


		document.body.appendChild(renderer.domElement);
		$("#WebGL-output").append(renderer.domElement);


		/*var box = new THREE.Object3D();
        var mesh;
        var loader = new THREE.OBJLoader();
        loader.load('../camera.obj', function (geo) {
			mesh = geo;
            mesh.rotation.y = Math.PI;
            mesh.position.y = -11.3;
            box.add(mesh);
        });
		var axes = new THREE.AxisHelper( 60 );
        box.add(axes);
        box.rotation.y = Math.PI;
        camObject = new THREE.Object3D();
		camObject.add(box);
		camObject.scale.set(0.05, 0.05, 0.05);
        camObject.position.x = camera2.position.x;
		camObject.position.y = camera2.position.y;
		camObject.position.z = camera2.position.z;
        scene.add(camObject);*/


		controls = new function () {
			this.cameraFollowingObject = false;
			this.fieldOfView = true;
			this.dollyZoomCamera = false;
			this.reset = function(){
				window.location.reload();
			};
			this.mainView = function (){
				if(controls.fieldOfView == true){
					console.log("TRUE");
					camControl = new THREE.TrackballControls( camera1, renderer.domElement );

					camera1.lookAt(scene.position);
				}
			};
			this.C_3 = function(){
				if(controls.dollyZoomCamera == true){
					console.log("Dualizumui pasiruošta");
					camera3.lookAt(scene.position);
				}
				c3 = true;
			};
			this.followObject = function (){
				if(controls.cameraFollowingObject == true){
					console.log("Ziuri i figura");
					var figure = scene.getObjectByName(pav);
					/*var d = Math.abs(camera2.position.x);
					var x = Math.abs(camera2.position.x - figure.position.x);
					console.log(x);
					var y = 1/d * x;
					var z = 1 - 1/d * x;
					camera2.up.set(0, z, y);
					camera2.up.set(1, 0, 0);
					camera2.up.set(z, y, 0);*/
					camera2.lookAt(figure.position);
					//console.log(figure.position);

				}
				c2 = !c2;
			};
            this.changeFigure = function (e) {
				if(e == 'Žirgas'){
					console.log(e);
					pav = e;
				}
				if(e == 'Bokštas'){
					console.log(e);
					pav = e;
				}
				if(e == 'Pėstininkas'){
					console.log(e);
					pav = e;
				}
			}
			this.zoom = 50;
			this.zooming = function (e){
				zoomCount = e;
			}
			this.dolly = 100;
			this.dollyZoom = function (e){
				dollyZoomCount = e;
			}
		};
        var gui = new dat.GUI();
        //gui.add(controls, "bumpScale", -2, 2).onChange(controls.updateBump);
    gui.add(controls, "changeFigure", ['Žirgas', 'Bokštas', 'Pėstininkas']).onChange(controls.changeFigure);
		gui.add(controls, "fieldOfView").onChange(controls.mainView);
		gui.add(controls, "dollyZoomCamera").onChange(controls.C_3);
		gui.add(controls, 'cameraFollowingObject').onChange(controls.followObject);
		gui.add(controls, 'zoom', 0, 50).onChange(controls.zooming);
		gui.add(controls, 'dolly', 0, 100).onChange(controls.dollyZoom);
		gui.add(controls, 'reset');

		addPlane();
    addChessTable();
		//controler();

		// ------------------  FIGURES  -------------------------
		// Black figures
        generatePawnFigures(-10, 5.3, -14, 0x555555); // black
		generateBishop(-14, 6, -6, 0x555555);
		generateKing(-14, 6.5, 2, 0x555555);//0x5F5F5F);
		generateQueen(-14, 6.4, -2, 0x555555);
		generateHorse(-14, 6.3, 10, 0x555555);
		generateTower(-14, 5.75, 14, 0x555555);
		generateTower(-14, 5.75, -14, 0x555555);

		// White figures
		generatePawnFigures(10, 5.3, -14, 0xf0f0f0);
		generateBishop(14, 6, -6, 0xf0f0f0);
		generateKing(14, 6.5, 2, 0xf0f0f0);
		generateQueen(14, 6.4, -2, 0xf0f0f0);
		generateHorse(14, 6.3, 10, 0xf0f0f0);
		generateTower(14, 5.75, 14, 0xf0f0f0);
		generateTower(14, 5.75, -14, 0xf0f0f0);
		// -------------------------------------------------------

		var spotLight = new THREE.SpotLight(0xffffff);
        spotLight.position.set(-30, 60, 60);
        spotLight.castShadow = true;
        scene.add(spotLight);
        render();
	}

	function addPlane(){
		var planeGeometry = new THREE.PlaneGeometry(32,32);
		var planeMaterial = new THREE.MeshLambertMaterial({color: 0xffffff});
		var plane = new THREE.Mesh(planeGeometry,planeMaterial);
		plane.receiveShadow  = true;
		plane.rotation.x=-0.5*Math.PI;
		plane.position.x=0
		plane.position.y=0
		plane.position.z=0
		scene.add(plane);
	}

  function addChessTable(){
		var x_ = -18;
		var y_ = 1;
		var z_ = -18;

		// create Chess table
		for(var i=1; i <= 8; i++){
			// create a cube

			for(var j=1; j <= 8; j++){
				var cubeGeometry = new THREE.CubeGeometry(4,2,4);
				if((i+j)%2 == 0){
					var cubeMaterial = new THREE.MeshLambertMaterial({color: 0xffffff});
				} else
					cubeMaterial = new THREE.MeshLambertMaterial({color: 0x000000});

				var cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
				cube.castShadow = true;

				// position the cube
				cube.position.x=x_ + i*4;
				cube.position.y=y_ ;
				cube.position.z=z_ + j*4;

				// add the cube to the scene
				scene.add(cube);
			}
		}
	}

	function generatePawnFigures(_x, _y, _z, clr) {

		var count = 61;
		var size = 0.27;
		var pointsX = [-5.699999999999996, -5.567599999999998, -5.204799999999997, -4.663199999999995, -3.994399999999997, -3.249999999999998, -2.481599999999999, -1.740799999999999, -1.0791999999999993, -0.5483999999999996, -0.19999999999999987, -0.23099999999999993, -0.16000000000000003, -0.010999999999999989, 0.1919999999999999, 0.4249999999999997, 0.6639999999999995, 0.8849999999999993, 1.0639999999999996, 1.1769999999999994, 1.1999999999999993, 1.7749999999999997, 2.34, 2.8949999999999987, 3.4399999999999986, 3.974999999999998, 4.499999999999997, 5.014999999999996, 5.519999999999996, 6.0149999999999935, 6.499999999999992, 6.540999999999992, 6.623999999999993, 6.74899999999999, 6.91599999999999, 7.124999999999989, 7.375999999999988, 7.668999999999987, 8.003999999999987, 8.380999999999984, 8.799999999999983, 8.756199999999984, 8.845599999999985, 9.039399999999981, 9.308799999999984, 9.624999999999982, 9.959199999999981, 10.28259999999998, 10.56639999999998, 10.78179999999998, 10.899999999999979, 10.958299999999978, 11.06639999999998, 11.214099999999975, 11.39119999999998, 11.587499999999977, 11.792799999999978, 11.996899999999977, 12.18959999999998, 12.360699999999978, 12.499999999999977];
		var pointsY = [-0.30000000000000004, 0.7279000000000007, 1.5392000000000015, 2.145300000000001, 2.5576000000000016, 2.787500000000002, 2.8464000000000014, 2.7457000000000016, 2.4968000000000012, 2.111100000000001, 1.6000000000000003, 2.031900000000001, 2.367200000000002, 2.605300000000001, 2.745600000000002, 2.7875000000000014, 2.7304000000000013, 2.5737000000000014, 2.316800000000001, 1.9591000000000007, 1.5000000000000002, 1.4960000000000004, 1.5240000000000005, 1.584, 1.6760000000000006, 1.8000000000000005, 1.9560000000000008, 2.144000000000001, 2.364000000000001, 2.616000000000001, 2.9000000000000012, 3.1280000000000014, 3.332000000000002, 3.512000000000002, 3.668000000000002, 3.8000000000000016, 3.9080000000000017, 3.9920000000000018, 4.052000000000001, 4.088000000000002, 4.100000000000001, 4.6732000000000005, 5.1336, 5.482399999999996, 5.720799999999997, 5.849999999999995, 5.8711999999999955, 5.785599999999996, 5.594399999999997, 5.298799999999997, 4.899999999999999, 5.1244999999999985, 5.315999999999999, 5.471499999999996, 5.587999999999997, 5.662499999999996, 5.691999999999996, 5.673499999999996, 5.603999999999997, 5.480499999999997, 5.299999999999997];
		var points = [];

		for (var k = 0; k < count; k++) {
			points.push(new THREE.Vector3(pointsY[k], 0, pointsX[k]));
		}

		for(var i = 0; i < 8; i++){
			var pawnGeometry = new THREE.LatheGeometry(points);
			var pawnMaterial = new THREE.MeshLambertMaterial({color: clr});
			var pawnMesh = new THREE.Mesh(pawnGeometry, pawnMaterial);
			pawnMesh.castShadow = true;

			pawnMesh.scale.set(size, size, size);
			pawnMesh.rotation.x = Math.PI / 2;

			pawnMesh.position.x = _x;
			pawnMesh.position.y = _y;
			pawnMesh.position.z = _z + i*4;

			//pawnMesh.position.y = 0.75 * Math.PI / 2;
			pawnMesh.name = 'Pėstininkas';

			scene.add(pawnMesh);
		}

	}

	function generateBishop(_x, _y, _z, clr){

		var count = 78; //-10
		var size = 0.45;
		var pointsX = [-4.300000000000001, -4.285600000000001, -4.244800000000002, -4.1812000000000005, -4.098400000000002, -4.000000000000001, -3.8896000000000015, -3.7708000000000017, -3.6472000000000016, -3.522400000000002, -3.4000000000000017, -3.173000000000002, -2.9160000000000026, -2.6350000000000007, -2.336000000000001, -2.0250000000000012, -1.708000000000001, -1.3910000000000011, -1.0800000000000007, -0.7810000000000008, -0.5000000000000007, -0.3830000000000008, -0.2720000000000009, -0.1670000000000009, -0.06800000000000099, 0.024999999999998912, 0.1119999999999988, 0.1929999999999987, 0.2679999999999987, 0.3369999999999986, 0.39999999999999847, 0.6999999999999975, 0.8000000000000009, 1.3000000000000047, 1.4000000000000083, 1.8000000000000123, 1.7953000000000128, 1.8344000000000131, 1.9071000000000127, 2.003200000000014, 2.1125000000000145, 2.224800000000015, 2.3299000000000154, 2.417600000000016, 2.4777000000000164, 2.5000000000000164, 2.50000000000002, 3.00600000000002, 3.4840000000000204, 3.9340000000000193, 4.356000000000019, 4.750000000000019, 5.116000000000019, 5.454000000000018, 5.764000000000018, 6.046000000000017, 6.300000000000017, 6.333900000000018, 6.427200000000018, 6.5673000000000155, 6.741600000000017, 6.937500000000016, 7.142400000000016, 7.343700000000016, 7.528800000000016, 7.685100000000016, 7.800000000000015, 7.806000000000017, 7.824000000000018, 7.854000000000014, 7.896000000000016, 7.950000000000016, 8.016000000000016, 8.094000000000015, 8.184000000000017, 8.286000000000016, 8.400000000000016, 8.900000000000016, 9.014000000000017, 9.116000000000017, 9.206000000000016, 9.284000000000017, 9.350000000000016, 9.404000000000018, 9.446000000000017, 9.476000000000017, 9.494000000000018, 9.5];
		var pointsY = [0, 0.10310000000000005, 0.17680000000000012, 0.22770000000000007, 0.26240000000000013, 0.2875000000000001, 0.3096000000000001, 0.33530000000000004, 0.3712000000000001, 0.42390000000000005, 0.5, 0.6145000000000002, 0.7680000000000003, 0.9455, 1.1320000000000003, 1.3125000000000002, 1.4720000000000004, 1.5955000000000004, 1.6680000000000006, 1.6745000000000005, 1.6000000000000003, 1.5580000000000005, 1.5120000000000007, 1.4620000000000002, 1.4080000000000001, 1.3500000000000003, 1.2880000000000003, 1.222, 1.1520000000000001, 1.0779999999999998, 0.9999999999999999, 1.3, 1.5000000000000002, 1.5000000000000002, 1.3, 1.7000000000000004, 1.754000000000001, 1.7960000000000012, 1.8260000000000005, 1.8440000000000007, 1.8500000000000008, 1.8440000000000003, 1.8260000000000005, 1.7960000000000007, 1.7540000000000007, 1.7000000000000004, 0.9999999999999999, 1.049, 1.116, 1.2009999999999998, 1.304, 1.4250000000000003, 1.5640000000000003, 1.7210000000000003, 1.8960000000000006, 2.0890000000000004, 2.3000000000000007, 2.5516000000000014, 2.7648000000000024, 2.9372000000000007, 3.066400000000002, 3.1500000000000017, 3.1856000000000018, 3.1708000000000016, 3.103200000000002, 2.9804000000000017, 2.800000000000001, 2.9130000000000016, 3.0120000000000022, 3.0970000000000013, 3.168000000000002, 3.2250000000000014, 3.268000000000002, 3.297000000000002, 3.312000000000002, 3.3130000000000015, 3.3000000000000016, 3.3000000000000016, 3.313000000000002, 3.3120000000000025, 3.297000000000002, 3.268000000000002, 3.2250000000000014, 3.168000000000002, 3.0970000000000013, 3.012000000000002, 2.9130000000000016, 2.800000000000001];
		var points = [];

		for (var k = 0; k < count; k++) {
			points.push(new THREE.Vector3(pointsY[k], 0, pointsX[k]));
		}

		for(var i = 0; i < 2; i++){
			var geometry = new THREE.LatheGeometry(points);
			var material = new THREE.MeshLambertMaterial({color: clr});
			var lathe = new THREE.Mesh(geometry, material);
			lathe.castShadow = true;

			lathe.scale.set(size, size, size);
			lathe.rotation.x = Math.PI / 2;

			lathe.position.x = _x;
			lathe.position.y = _y;
			lathe.position.z = _z + i*12;

			scene.add(lathe);

		}
	}

	function generateKing(_x, _y, _z, clr){

		var count = 159; //-12
		var size = 0.38;
		var pointsX = [-5.999999999999995, -5.977999999999995, -5.951999999999996, -5.921999999999994, -5.8879999999999955, -5.849999999999994, -5.807999999999996, -5.761999999999995, -5.711999999999996, -5.657999999999996, -5.599999999999996, -4.999999999999999, -5, -4.928900000000001, -4.839200000000003, -4.736300000000001, -4.625600000000001, -4.512500000000002, -4.402400000000003, -4.300700000000003, -4.212800000000003, -4.144100000000004, -4.100000000000004, -4.1000000000000005, -3.6999999999999975, -3.6779999999999973, -3.6519999999999975, -3.621999999999996, -3.587999999999996, -3.5499999999999954, -3.5079999999999956, -3.4619999999999944, -3.4119999999999946, -3.3579999999999943, -3.2999999999999936, -3.2929999999999935, -3.2719999999999936, -3.236999999999992, -3.1879999999999926, -3.1249999999999916, -3.047999999999991, -2.956999999999991, -2.8519999999999905, -2.73299999999999, -2.5999999999999894, -2.4161999999999892, -2.2215999999999894, -2.011399999999988, -1.7807999999999877, -1.524999999999987, -1.2391999999999863, -0.918599999999986, -0.5583999999999851, -0.1537999999999848, 0.30000000000001525,
		0.30000000000000004, 0.30000000000000016, 0.3020000000000001, 0.30800000000000005, 0.3179999999999999, 0.33199999999999985, 0.34999999999999976, 0.37199999999999966, 0.3979999999999996, 0.42799999999999955, 0.4619999999999994, 0.49999999999999933, 1.0999999999999983, 1.1379999999999983, 1.1719999999999984, 1.201999999999998, 1.227999999999998, 1.249999999999998, 1.2679999999999978, 1.2819999999999978, 1.2919999999999978, 1.2979999999999978, 1.2999999999999976, 1.3000000000000012, 1.5000000000000049, 1.5000000000000084, 1.5020000000000089, 1.5080000000000096, 1.5180000000000093, 1.5320000000000098, 1.55000000000001, 1.5720000000000107, 1.598000000000011, 1.6280000000000117, 1.662000000000012, 1.7000000000000122, 1.7380000000000126, 1.7720000000000133, 1.8020000000000131, 1.8280000000000136, 1.8500000000000143, 1.8680000000000143, 1.8820000000000148, 1.8920000000000152, 1.8980000000000157, 1.900000000000016, 1.9000000000000195, 2.7640000000000184, 3.5560000000000183, 4.276000000000017, 4.9240000000000155, 5.500000000000016, 6.004000000000015, 6.436000000000014, 6.7960000000000145, 7.084000000000014, 7.300000000000013, 7.326000000000014, 7.364000000000016, 7.414000000000013, 7.476000000000013, 7.550000000000015, 7.636000000000014, 7.734000000000014, 7.8440000000000145, 7.9660000000000135, 8.100000000000014, 8.100000000000017, 8.124000000000017, 8.156000000000018, 8.196000000000017, 8.244000000000018, 8.300000000000018, 8.364000000000019, 8.436000000000018, 8.51600000000002, 8.604000000000019, 8.700000000000019, 9.50000000000002, 9.596000000000021, 9.684000000000022, 9.76400000000002, 9.83600000000002, 9.90000000000002, 9.95600000000002, 10.004000000000019, 10.044000000000022, 10.07600000000002, 10.100000000000021, 10.300000000000008, 10.299999999999994, 10.323999999999993, 10.355999999999993, 10.395999999999988, 10.443999999999987, 10.499999999999986, 10.563999999999982, 10.635999999999981, 10.715999999999982, 10.80399999999998, 
		10.899999999999977, 11.69999999999996, 11.795999999999959, 11.883999999999958, 11.963999999999956, 12.035999999999953, 12.099999999999952, 12.155999999999949, 12.203999999999947, 12.243999999999946, 12.275999999999945, 12.299999999999944];

		var pointsY = [0.20000000000000004, 0.2760000000000001, 0.34400000000000014, 0.40399999999999997, 0.45600000000000007, 0.5, 0.536, 0.5640000000000001, 0.5840000000000001, 0.596, 0.6, 0.6, 1.2, 1.3566000000000007, 1.4688000000000008, 1.5402, 1.5744000000000007, 1.5750000000000004, 1.5456000000000003, 1.4898000000000002, 1.4112000000000005, 1.3134000000000001, 1.2, 0.6, 0.6, 0.639, 0.6760000000000002, 0.7109999999999999, 0.744, 0.775, 0.804, 0.831, 0.856, 0.879, 0.8999999999999999, 1.2230000000000003, 1.512000000000001, 1.7670000000000003, 1.9880000000000009, 2.175000000000001, 2.328000000000001, 2.447000000000001, 2.5320000000000014, 2.583000000000001, 2.600000000000001, 2.5692000000000017, 2.485600000000002, 2.3624000000000005, 2.212800000000001, 2.050000000000001, 1.8872000000000007, 1.7376000000000005, 1.6144000000000007, 1.5308000000000004, 1.5000000000000002,
		1.5000000000000002, 1.7000000000000004, 1.7380000000000007, 1.7720000000000011, 1.8020000000000003, 1.8280000000000005, 1.8500000000000005, 1.8680000000000008, 1.8820000000000006, 1.8920000000000006, 1.8980000000000006, 1.9000000000000004, 1.9000000000000006, 1.8980000000000006, 1.8920000000000012, 1.8820000000000006, 1.8680000000000008, 1.8500000000000005, 1.8280000000000007, 1.8020000000000005, 1.7720000000000007, 1.7380000000000004, 1.7000000000000004, 1.5000000000000002, 1.5000000000000002, 2.0000000000000004, 2.0380000000000007, 2.072000000000001, 2.1020000000000003, 2.128000000000001, 2.150000000000001, 2.1680000000000006, 2.1820000000000004, 2.1920000000000006, 2.198000000000001, 2.2000000000000006, 2.198000000000001, 2.192000000000001, 2.182000000000001, 2.168000000000001, 2.150000000000001, 2.1280000000000006, 2.1020000000000008, 2.0720000000000005, 2.0380000000000007, 2.0000000000000004, 1.5000000000000002, 1.4610000000000003, 1.4640000000000004, 1.509, 1.5960000000000005, 1.7250000000000005, 1.8960000000000008, 2.109000000000001, 2.364000000000001, 2.661000000000001, 3.0000000000000013, 3.0190000000000015, 3.0360000000000023, 3.051000000000001, 3.064000000000002, 3.0750000000000015, 3.084000000000002, 3.091000000000002, 3.096000000000002, 3.099000000000002, 3.1000000000000014, 4.000000000000002, 4.075000000000002, 4.140000000000002, 4.195000000000001, 4.240000000000002, 4.275000000000001, 4.300000000000002, 4.315000000000001, 4.320000000000001, 4.315000000000001, 4.300000000000001, 4.300000000000001, 4.315000000000001, 4.320000000000002, 4.315000000000001, 4.300000000000002, 4.275000000000001, 4.240000000000001, 4.195000000000001, 4.140000000000002, 4.075000000000001, 4.000000000000002, 4.000000000000002, 4.5, 4.575, 4.640000000000001, 4.694999999999999, 4.739999999999999, 4.7749999999999995, 4.8, 4.8149999999999995, 4.819999999999999, 4.8149999999999995,
		4.799999999999999, 4.799999999999999, 4.8149999999999995, 4.82, 4.814999999999999, 4.799999999999999, 4.7749999999999995, 4.74, 4.694999999999999, 4.640000000000001, 4.575, 4.5];

		var points = [];

		for (var k = 0; k < count; k++) {
			points.push(new THREE.Vector3(pointsY[k], 0, pointsX[k]));
		}

		var geometry = new THREE.LatheGeometry(points);
		var material = new THREE.MeshLambertMaterial({color: clr});
		var lathe = new THREE.Mesh(geometry, material);
		lathe.castShadow = true;
		lathe.scale.set(size, size, size);
		lathe.rotation.x = Math.PI / 2;

		lathe.position.x = _x;
		lathe.position.y = _y;
		lathe.position.z = _z;

		scene.add(lathe);

	}

	function generateQueen(_x, _y, _z, clr){

		var count = 126;
		var size = 0.2;
		var pointsX = [-12.399999999999972, -12.330399999999974, -12.191199999999975, -11.99679999999997, -11.761599999999975, -11.499999999999975, -11.226399999999977, -10.955199999999978, -10.70079999999998, -10.47759999999998, -10.29999999999998, -10.20499999999998, -10.079999999999984, -9.92499999999998, -9.739999999999984, -9.524999999999984, -9.279999999999985, -9.004999999999987, -8.699999999999987, -8.364999999999988, -7.999999999999989, -8.799999999999986, -8.183999999999989, -7.5759999999999925, -6.975999999999993, -6.383999999999995, -5.799999999999996, -5.223999999999998, -4.656000000000001, -4.096000000000002, -3.5440000000000027, -3.000000000000004, -3.0000000000000004, -2.9190000000000005, -2.8360000000000003, -2.750999999999999, -2.663999999999999, -2.5749999999999984, -2.4839999999999978, -2.3909999999999973, -2.295999999999997, -2.1989999999999963, -2.099999999999996, -2.0306999999999964, -1.893599999999996, -1.7048999999999948, -1.4807999999999946, -1.2374999999999938, -0.9911999999999935, -0.7580999999999929, -0.5543999999999922, -0.39629999999999205, -0.29999999999999194, -0.2009999999999916, -0.10399999999999121, -0.008999999999990807, 0.08400000000000954, 0.17500000000000987, 0.2640000000000102, 0.3510000000000105, 0.436000000000011, 0.5190000000000113, 0.6000000000000116, 0.6000000000000152, 2.3320000000000123, 3.9680000000000097, 5.508000000000006, 6.9520000000000035, 8.3, 9.551999999999998, 10.707999999999995, 11.767999999999994, 12.73199999999999, 13.599999999999987, 13.59999999999999, 13.669399999999992, 13.807199999999995, 13.99779999999999, 14.225599999999991, 14.474999999999989, 14.730399999999989, 14.976199999999988, 15.196799999999989, 15.37659999999999, 15.499999999999988, 15.902599999999994, 16.2248, 16.488199999999992, 16.7144, 16.925, 17.141600000000004, 17.385800000000007, 17.679200000000016, 18.04340000000002, 18.500000000000025, 18.69300000000003, 18.872000000000032, 19.037000000000027, 19.188000000000038, 19.32500000000004, 
		19.44800000000004, 19.55700000000004, 19.652000000000044, 19.733000000000047, 19.800000000000047,
		19.808000000000046, 19.83200000000005, 19.87200000000005, 19.92800000000005, 20.00000000000005, 20.08800000000005, 20.192000000000057, 20.312000000000058, 20.448000000000057, 20.600000000000062, 21.60000000000008, 21.75200000000008, 21.888000000000087, 22.008000000000077, 22.112000000000084, 22.20000000000008, 22.27200000000008, 22.32800000000008, 22.36800000000008, 22.392000000000078, 22.400000000000077];

		var pointsY = [0, 0.35700000000000015, 0.6480000000000004, 0.873, 1.0320000000000005, 1.1250000000000002, 1.1520000000000001, 1.1130000000000002, 1.0080000000000002, 0.8370000000000002, 0.6, 1.0020000000000002, 1.3680000000000008, 1.6980000000000004, 1.9920000000000009, 2.250000000000001, 2.4720000000000013, 2.6580000000000013, 2.8080000000000016, 2.922000000000001, 3.0000000000000013, 4.100000000000001, 3.7920000000000016, 3.5080000000000022, 3.248000000000001, 3.0120000000000013, 2.8000000000000016, 2.612000000000001, 2.4480000000000013, 2.3080000000000007, 2.1920000000000006, 2.1000000000000005, 2.600000000000001, 2.7090000000000014, 2.796000000000002, 2.861000000000001, 2.9040000000000017, 2.9250000000000016, 2.9240000000000017, 2.9010000000000016, 2.8560000000000016, 2.7890000000000015, 2.700000000000001, 3.051000000000002, 3.324000000000003, 3.5190000000000015, 3.6360000000000023, 3.6750000000000025, 3.636000000000002, 3.519000000000002, 3.3240000000000025, 3.0510000000000015, 2.700000000000001, 2.7890000000000015, 2.856000000000002, 2.901000000000001, 2.9240000000000017, 2.9250000000000016, 2.9040000000000017, 2.8610000000000015, 2.7960000000000016, 2.709000000000001, 2.600000000000001, 2.1000000000000005, 2.128000000000001, 2.172000000000001, 2.2320000000000007, 2.308000000000001, 2.4000000000000012, 2.508000000000001, 2.6320000000000014, 2.7720000000000016, 2.9280000000000017, 3.1000000000000014, 3.700000000000002, 3.999700000000001, 4.237600000000002, 4.411899999999999, 4.520800000000001, 4.5625, 4.535200000000001, 4.437100000000001, 4.266400000000001, 4.021300000000001, 3.700000000000002, 3.898000000000002, 4.2280000000000015, 4.653999999999999, 5.139999999999998, 5.649999999999997, 6.147999999999994, 6.597999999999992, 6.9639999999999915, 7.209999999999991, 7.29999999999999, 7.291999999999991, 7.267999999999992, 7.22799999999999, 7.171999999999991, 7.099999999999991,
		7.011999999999992, 6.9079999999999915, 6.787999999999993, 6.651999999999992, 6.499999999999993,
		6.861999999999992, 7.1879999999999935, 7.477999999999989, 7.731999999999989, 7.949999999999989, 8.131999999999987, 8.277999999999988, 8.387999999999987, 8.461999999999987, 8.499999999999986, 8.499999999999986, 8.472999999999988, 8.43199999999999, 8.376999999999986, 8.307999999999986, 8.224999999999987, 8.127999999999988, 8.016999999999989, 7.891999999999989, 7.7529999999999895, 7.599999999999989];

		var points = [];

		for (var k = 0; k < count; k++) {
			points.push(new THREE.Vector3(pointsY[k], 0, pointsX[k]));
		}

		var geometry = new THREE.LatheGeometry(points);
		var material = new THREE.MeshLambertMaterial({color: clr});
		var lathe = new THREE.Mesh(geometry, material);
		lathe.castShadow = true;
		lathe.scale.set(size, size, size);
		lathe.rotation.x = Math.PI / 2;

		lathe.position.x = _x;
		lathe.position.y = _y;
		lathe.position.z = _z;
		lathe.name = "Karalienė";

		scene.add(lathe);

	}

	function generateHorse(_x, _y, _z, clr){

		var points = [new THREE.Vector2 (-4.757829570284043,  0),
		new THREE.Vector2 (8.13971837824716,  0),
		new THREE.Vector2 (7.580951080359324,  1.0191948288419521),
		new THREE.Vector2 (7.766448167030847,  2.2444981791697027),
		new THREE.Vector2 (8.41625697984949,  3.6274883466860897),
		new THREE.Vector2 (9.250424860403022,  5.119743627093957),
		new THREE.Vector2 (9.98899915027921,  6.672842316096143),
		new THREE.Vector2 (10.352027191065806,  8.238362709395489),
		new THREE.Vector2 (10.059556324350583,  9.767883102694832),
		new THREE.Vector2 (8.831633891721303,  11.212981791697022),
		new THREE.Vector2 (6.388307234765731,  12.525237072104888),
		new THREE.Vector2 (2.4496236950716295,  13.656227239621275),
		new THREE.Vector2 (2.2885651857247002,  13.876244234037397),
		new THREE.Vector2 (2.1088613741199413,  14.081087642631719),
		new THREE.Vector2 (1.9105122602573523,  14.270757465404232),
		new THREE.Vector2 (1.693517844136934,  14.445253702354949),
		new THREE.Vector2 (1.4578781257586861,  14.604576353483864),
		new THREE.Vector2 (1.2035931051226083,  14.748725418790979),
		new THREE.Vector2 (0.930662782228701,  14.877700898276288),
		new THREE.Vector2 (0.6390871570769635,  14.991502791939801),
		new THREE.Vector2 (0.3288662296673966,  15.09013109978151),
		new THREE.Vector2 (0,  15.173585821801417),
		new THREE.Vector2 (0,  13.656227239621275),
		new THREE.Vector2 (-2.1024520514687968,  13.27688759407624),
		new THREE.Vector2 (-1.3437727603787248,  12.518208302986169),
		new THREE.Vector2 (-4.757829570284043,  12.138868657441133),
		new THREE.Vector2 (-10.447924253459576,  9.104151493080849),
		new THREE.Vector2 (-10.561726147123087,  8.739985433357615),
		new THREE.Vector2 (-10.59966011167759,  8.406166545277985),
		new THREE.Vector2 (-10.561726147123085,  8.102694828841955),
		new THREE.Vector2 (-10.447924253459574,  7.829570284049531),
		new THREE.Vector2 (-10.258254430687057,  7.586792910900708),
		new THREE.Vector2 (-9.992716678805532,  7.374362709395488),
		new THREE.Vector2 (-9.651310997815001,  7.192279679533872),
		new THREE.Vector2 (-9.234037387715462,  7.0405438213158575),
		new THREE.Vector2 (-8.740895848506916,  6.919155134741446),
		new THREE.Vector2 (-8.171886380189363,  6.828113619810638),
		new THREE.Vector2 (-7.255201141053652,  6.685481913085704),
		new THREE.Vector2 (-6.524333090555958,  6.688516630250066),
		new THREE.Vector2 (-5.9354126001456615,  6.800801165331392),
		new THREE.Vector2 (-5.444570041272148,  6.985918912357372),
		new THREE.Vector2 (-5.007935785384797,  7.207453265355673),
		new THREE.Vector2 (-4.581640203932989,  7.4289876183539745),
		new THREE.Vector2 (-4.121813668366103,  7.614105365379951),
		new THREE.Vector2 (-3.5845865501335226,  7.726389900461282),
		new THREE.Vector2 (-2.9260892206846267,  7.729424617625643),
		new THREE.Vector2 (-2.1024520514687968,  7.586792910900709),
		new THREE.Vector2 (0.5529254673464514,  7.207453265355673),
		new THREE.Vector2 (-1.1389293517844064,  6.3160050983248395),
		new THREE.Vector2 (-2.57283321194464,  5.462490895848511),
		new THREE.Vector2 (-3.7487861131342495,  4.646910657926683),
		new THREE.Vector2 (-4.666788055353235,  3.869264384559361),
		new THREE.Vector2 (-5.326839038601596,  3.129552075746542),
		new THREE.Vector2 (-5.728939062879334,  2.4277737314882266),
		new THREE.Vector2 (-5.873088128186447,  1.763929351784415),
		new THREE.Vector2 (-5.7592862345229365,  1.138018936635106),
		new THREE.Vector2 (-5.387533381888802,  0.5500424860403013),
		new THREE.Vector2 (-4.757829570284043,  0)];


		// ------ Horse head ------

		//var size =

		var knightsize = 0.15;
		var shape = new THREE.Shape(points);

		var extrudeSettings = {
			amount: 3,
			steps: 2,
			depth: 3,
			bevelEnabled: true,
			bevelThickness: 1,
			bevelSize: 1,
			bevelOffset: 0,
			bevelSegments: 15,
			curveSegments: 4
		};
		var knight_x = _x + 0.25;
		var knight_y = 4.8;
		var knight_z = _z + 0.25;

		for(var i = 0; i < 2; i++){
			//var geometry = new THREE.LatheGeometry(points);
			var knightGeometry = new THREE.ExtrudeGeometry( shape, extrudeSettings );
			var knightMaterial = new THREE.MeshLambertMaterial( { color: clr } );
			var knightHead = new THREE.Mesh( knightGeometry, knightMaterial ) ;
			knightHead.castShadow = true;
			if(clr == 0x555555)
				knightHead.rotation.y = Math.PI;
			else{
				knight_z = _z - 0.25;
				knight_x = _x - 0.25;
			}
			knightHead.position.set(knight_x, knight_y, knight_z);
			knightHead.scale.set(knightsize, knightsize, knightsize);
			//scene.add(knightHead);

			// ----- Horse head generated ------

			var count = 56;
			var latheSize = 0.2;
			var pointsX = [8.199999999999987, 8.099999999999989, 8.099999999999987, 8.128999999999989, 8.17599999999999, 8.240999999999987, 8.323999999999987, 8.424999999999986, 8.543999999999986, 8.680999999999987, 8.835999999999986, 9.008999999999986, 9.199999999999985, 9.353999999999985, 9.495999999999986, 9.625999999999982, 9.743999999999982, 9.849999999999982, 9.943999999999981, 10.02599999999998, 10.09599999999998, 10.15399999999998, 10.19999999999998, 10.19999999999998, 10.36099999999998, 10.52399999999998, 10.688999999999977, 10.855999999999977, 11.024999999999975, 11.195999999999975, 11.368999999999975, 11.543999999999974, 11.720999999999973, 11.899999999999972, 12.005999999999974, 12.123999999999974, 12.25399999999997, 12.395999999999972, 12.549999999999972, 12.71599999999997, 12.89399999999997, 13.083999999999971, 13.28599999999997, 13.49999999999997, 13.499999999999973, 13.524999999999974, 13.559999999999977, 13.604999999999972, 13.659999999999975, 13.724999999999975, 13.799999999999976, 13.884999999999975, 13.979999999999976, 14.084999999999974, 14.199999999999974, 15.799999999999972];

			var pointsY = [5.999999999999995, -0.30000000000000004, 5.999999999999995, 6.1139999999999946, 6.215999999999995, 6.305999999999994, 6.383999999999993, 6.449999999999994, 6.5039999999999925, 6.545999999999993, 6.575999999999993, 6.593999999999992, 6.5999999999999925, 6.593999999999992, 6.575999999999994, 6.545999999999992, 6.5039999999999925, 6.449999999999994, 6.383999999999993, 6.305999999999994, 6.215999999999994, 6.1139999999999946, 5.999999999999995, 5.299999999999997, 5.209999999999998, 5.139999999999999, 5.089999999999997, 5.059999999999999, 5.049999999999999, 5.059999999999999, 5.089999999999998, 5.139999999999999, 5.209999999999998, 5.299999999999997, 5.5349999999999975, 5.759999999999997, 5.974999999999994, 6.179999999999994, 6.374999999999993, 6.559999999999993, 6.734999999999992, 6.8999999999999915, 7.054999999999991, 7.19999999999999, 7.699999999999989, 7.79599999999999, 7.883999999999991, 7.963999999999988, 8.035999999999989, 8.099999999999987, 8.155999999999988, 8.203999999999988, 8.243999999999987, 8.275999999999987, 8.299999999999986, 8.299999999999986];

			var points = [];

			for (var k = 0; k < count; k++) {
				points.push(new THREE.Vector3(pointsY[k], 0, pointsX[k]));
			}

			var baseGeometry = new THREE.LatheGeometry(points);
			var baseMaterial = new THREE.MeshLambertMaterial({color: clr});
			var knightBase = new THREE.Mesh(baseGeometry, baseMaterial);
			knightBase.castShadow = true;
			knightBase.scale.set(latheSize, latheSize, latheSize);
			knightBase.rotation.x = Math.PI / 2;

			knightBase.position.x = _x;
			knightBase.position.y = _y;
			knightBase.position.z = _z;

			var group = new THREE.Group();
			group.add( knightHead );
			group.add( knightBase );
			if(i == 0)
				group.position.z = 0;
			if(i == 1)
				group.position.z = -20;
			group.position.y = -1.2;
			group.name = "Žirgas";
			scene.add( group );
		}
	}

	function generateTower(_x, _y, _z, clr){


		// -------- Tower base ----------

		var points = [];
		var count = 50;
		var latheSize = 0.27;
		var pointsX = [-2.400000000000001, -2.168000000000002, -2.0580000000000016, -1.9520000000000017, -1.8500000000000019, -1.7520000000000018, -1.6580000000000017, -1.5680000000000018, -1.482000000000002, -1.400000000000002, -1.1490000000000022, -0.916000000000002, -0.7010000000000018, -0.504000000000002, -0.32500000000000207, -0.16400000000000214, -0.02100000000000224, 0.10399999999999783, 0.21099999999999772, 0.2999999999999976, 1.749999999999996, 3.0999999999999948, 4.3499999999999925, 5.499999999999991, 6.549999999999988, 7.499999999999988, 8.349999999999985, 9.099999999999985, 9.749999999999984, 10.299999999999981, 10.368999999999984, 10.455999999999984, 10.560999999999979, 10.683999999999982, 10.824999999999982, 10.98399999999998, 11.16099999999998, 11.35599999999998, 11.56899999999998, 11.79999999999998, 11.875099999999978, 12.028799999999983, 12.243699999999977, 12.502399999999978, 12.787499999999977, 13.081599999999977, 13.367299999999977, 13.627199999999977, 13.843899999999977, 13.999999999999975];

		var pointsY = [0, 4.1800000000000015, 4.155000000000001, 4.120000000000002, 4.075000000000002, 4.020000000000001, 3.955000000000002, 3.880000000000002, 3.7950000000000017, 3.700000000000002, 3.763000000000002, 3.7920000000000025, 3.7870000000000017, 3.748000000000002, 3.6750000000000016, 3.568000000000002, 3.427000000000002, 3.2520000000000016, 3.0430000000000015, 2.800000000000001, 2.8120000000000016, 2.848000000000002, 2.9080000000000013, 2.9920000000000018, 3.1000000000000014, 3.232000000000002, 3.3880000000000017, 3.5680000000000023, 3.772000000000002, 4.000000000000002, 4.170000000000002, 4.320000000000002, 4.45, 4.5600000000000005, 4.65, 4.72, 4.77, 4.8, 4.81, 4.799999999999999, 5.105099999999999, 5.356799999999999, 5.549699999999996, 5.678399999999997, 5.737499999999995, 5.721599999999995, 5.625299999999996, 5.443199999999997, 5.169899999999998, 4.799999999999999];

		var groupCrown = new THREE.Group();
		for (var k = 0; k < count; k++) {
			points.push(new THREE.Vector3(pointsY[k], 0, pointsX[k]));
		}

		var xsas = -14.7;
		var ykas = 6.5;
		var ztas = 14;


		var baseGeometry = new THREE.LatheGeometry(points);
		var baseMaterial = new THREE.MeshLambertMaterial({color: clr});
		var towerBase = new THREE.Mesh(baseGeometry, baseMaterial);
		towerBase.castShadow = true;
		towerBase.scale.set(latheSize, latheSize, latheSize);
		towerBase.rotation.x = Math.PI / 2;

		towerBase.position.x = _x;
		towerBase.position.y = _y;
		towerBase.position.z = _z;
		scene.add(towerBase);

		// Tower karuna

		if(_z == 14 && clr == 0x555555){
			ztas = 14;
		}
		if(_z == -14 && clr == 0x555555){
			ztas = -14;
		}
		if(_x == 14 && clr == 0xf0f0f0){
			xsas = 13.3;
		}
		if(_z == -14 && clr == 0xf0f0f0){
			ztas = -14;
		}
		for(var i = 0; i < 4; i++){

			var shape = new THREE.Shape();
			shape.moveTo(0, 0);
			shape.quadraticCurveTo(5, -6, 10, 0);
			shape.lineTo(10, 10);
			shape.quadraticCurveTo(5, 4, 0, 10);
			shape.lineTo(0, 0);

			var extrudeSettings = {
				amount: controls.amount,
				bevelThickness: controls.bevelThickness,
				bevelSize: controls.bevelSize,
				bevelSegments: controls.bevelSegments,
				bevelEnabled: controls.bevelEnabled,
				curveSegments: controls.curveSegments,
				steps: controls.steps
			};

			var crownGeometry = new THREE.ExtrudeGeometry(shape, extrudeSettings);
			var crownMaterial = new THREE.MeshLambertMaterial({color: clr});
			//var oneTopPart = new THREE.Object3D();
			var crown = new THREE.Mesh(crownGeometry, crownMaterial);
			crown.castShadow = true;
			crown.scale.set(0.03, 0.04, 0.01);

			if(i == 0)
				crown.position.set(xsas-0.25, ykas, ztas-0.5);
				crown.rotation.y = 0;
				scene.add(crown);
				groupCrown.add(crown);
			if(i == 1){
				crown.position.set(xsas+0.15, ykas, ztas-0.6);
				crown.rotation.y = Math.PI/2;
				scene.add(crown);
				groupCrown.add(crown);
			}
			if(i == 2){
				crown.position.set(xsas+1.55, ykas, ztas+0.5);
				crown.rotation.y = Math.PI;
				scene.add(crown);
				groupCrown.add(crown);
			}
			if(i == 3){
				crown.position.set(xsas+1.15, ykas, ztas+0.6);
				crown.rotation.y = Math.PI*(3/2);
				scene.add(crown);
				groupCrown.add(crown);
			}
		}
		scene.add(groupCrown);
		var group = new THREE.Group();
		group.add(towerBase);
		group.add(groupCrown);
		group.name = "Bokštas";
		scene.add(group);

	}


	var step = 0;
	var pointAReached = false;
	var pointBReached = false;
	var XUpperPos = 6;
	var XLowerPos = -10;

	var knightIsMovingUp;
	var knightIsMovingDown;
	var knightIsMovingStraight;
	var knightIsMovingBack;
	var knightIsMovingLeft;
	var knightIsMovingRight;
	var towerIsMovingUp;
	var towerIsMovingDown;
	var towerIsMovingStraight;
	var towerIsMovingBack;
	var towerIsMovingLeft;
	var towerIsMovingRight;
	var towerIsMovingUp;
	var towerIsMovingDown;
	var	towerIsMovingStraight;
	var	towerIsMovingBack;
	var	towerIsMovingLeft;
	var	towerIsMovingRight;
	var UP_done = false;
	var STRAIGHT_done = false;
	var LEFT_done = false;
	var DOWN_done = false;
	var RIGHT_done = false;
	var BACK_done = false;

	var R_pressed = false;
	var T_pressed = false;
	var E_pressed = false;
	var Y_pressed = false;
	var D_pressed = false;
	var H_pressed = false;
	var F_pressed = false;
	var G_pressed = false;
	var UP_pressed = false;
	var DOWN_pressed = false;
	var LEFT_pressed = false;
	var RIGHT_pressed = false;
	var SPACE_pressed = false;
	var ONE_pressed = false;
	var	TWO_pressed = false;

	var k;

	var beganStraight = false;
	var beganBack = false;
	var beganLeft = false;
	var beganRight = false;
	var beganStraightChecker = 0;
	var beganBackChecker = 0;
	var beganLeftChecker = 0;
	var beganRightChecker = 0;

	var countSteps = 0;
	var firstTime = 0;


	function knightMovement(name){

		keyboard.update();

		if(keyboard.down("R") || R_pressed == true)
		{
			if(keyboard.down("R")){
				beganStraightChecker = 0;
				beganLeftChecker = 0;
			}
			R_pressed = true;
			console.log("R_pressed");
			resetKnight();
			knightIsMovingUp = true;
			moveUp(name);

			if(UP_done == true)
			{
				console.log("UP_done");
				resetKnight();
				knightIsMovingStraight = true;
				beganStraightChecker++;
				if(beganStraightChecker == 1){
					beganStraight = true;
				}
				moveStraight(name, 2);

				if(STRAIGHT_done == true)
				{
					console.log("STRAIGHT_done");
					resetKnight();
					knightIsMovingLeft = true;
					beganLeftChecker++;
					if(beganLeftChecker == 1){
						beganLeft = true;
					}
					moveLeft(name, 1);

					if(LEFT_done ==  true)
					{
						console.log("LEFT_done");
						resetKnight();
						knightIsMovingDown = true;
						moveDown(name);
						if(DOWN_done == true){
							resetKnight();
							resetDones();
							resetPresses();
						}
					}
				}

			}
		}

		if(keyboard.down("T") || T_pressed == true)
		{
			if(keyboard.down("T")){
				beganStraightChecker = 0;
				beganRightChecker = 0;
			}
			T_pressed = true;
			console.log("T_pressed");
			resetKnight();
			knightIsMovingUp = true;
			moveUp(name);

			if(UP_done == true)
			{
				console.log("UP_done");
				resetKnight();
				knightIsMovingStraight = true;
				beganStraightChecker++;
				if(beganStraightChecker == 1){
					beganStraight = true;
				}
				moveStraight(name, 2);

				if(STRAIGHT_done == true)
				{
					console.log("STRAIGHT_done");
					resetKnight();
					knightIsMovingRight = true;
					beganRightChecker++;
					if(beganRightChecker == 1){
						beganRight = true;
					}
					moveRight(name, 1);

					if(RIGHT_done == true)
					{
						console.log("RIGHT_done");
						resetKnight();
						knightIsMovingDown = true;
						moveDown(name);
						if(DOWN_done == true){
							resetKnight();
							resetDones();
							resetPresses();
						}
					}
				}
			}
		}

		if(keyboard.down("E") || E_pressed == true)
		{
			if(keyboard.down("E")){
				beganStraightChecker = 0;
				beganLeftChecker = 0;
			}
			E_pressed = true;
			console.log("E_pressed");
			resetKnight();
			knightIsMovingUp = true;
			moveUp(name);

			if(UP_done == true)
			{
				console.log("UP_done");
				resetKnight();
				knightIsMovingLeft = true;
				beganLeftChecker++;
				if(beganLeftChecker == 1){
					beganLeft = true;
				}
				moveLeft(name, 2);

				if(LEFT_done == true)
				{
					console.log("LEFT_done");
					resetKnight();
					knightIsMovingStraight = true;
					beganStraightChecker++;
					if(beganStraightChecker == 1){
						beganStraight = true;
					}
					moveStraight(name, 1);

					if(STRAIGHT_done == true)
					{
						console.log("STRAIGHT_done ");
						resetKnight();
						knightIsMovingDown = true;
						moveDown(name);
						if(DOWN_done == true){
							resetKnight();
							resetDones();
							resetPresses();
						}
					}
				}
			}
		}

		if(keyboard.down("Y") || Y_pressed == true)
		{
			if(keyboard.down("Y")){
				beganStraightChecker = 0;
				beganRightChecker = 0;
			}
			Y_pressed = true;
			console.log("Y_pressed");
			resetKnight();
			knightIsMovingUp = true;
			moveUp(name);

			if(UP_done == true)
			{
				console.log("UP_done");
				resetKnight();
				knightIsMovingRight = true;
				beganRightChecker++;
				if(beganRightChecker == 1){
					beganRight = true;
				}
				moveRight(name, 2);

				if(RIGHT_done == true)
				{
					console.log("RIGHT_done");
					resetKnight();
					knightIsMovingStraight = true;
					beganStraightChecker++;
					if(beganStraightChecker == 1){
						beganStraight = true;
					}
					moveStraight(name, 1);

					if(STRAIGHT_done == true)
					{
						console.log("STRAIGHT_done ");
						resetKnight();
						knightIsMovingDown = true;
						moveDown(name);
						if(DOWN_done == true){
							resetKnight();
							resetDones();
							resetPresses();
						}
					}
				}
			}
		}

		if(keyboard.down("D") || D_pressed == true)
		{
			if(keyboard.down("D")){
				beganBackChecker = 0;
				beganLeftChecker = 0;
			}
			D_pressed = true;
			console.log("D_pressed");
			resetKnight();
			knightIsMovingUp = true;
			moveUp(name);

			if(UP_done == true)
			{
				console.log("UP_done");
				resetKnight();
				knightIsMovingLeft = true;
				beganLeftChecker++;
				if(beganLeftChecker == 1){
					beganLeft = true;
				}
				moveLeft(name, 2);

				if(LEFT_done == true)
				{
					console.log("LEFT_done");
					resetKnight();
					knightIsMovingBack = true;
					beganBackChecker++;
					if(beganBackChecker == 1){
						beganBack = true;
					}
					moveBack(name, 1);

					if(BACK_done == true)
					{
						console.log("BACK_done");
						resetKnight();
						knightIsMovingDown = true;
						moveDown(name);
						if(DOWN_done == true){
							resetKnight();
							resetDones();
							resetPresses();
						}
					}
				}
			}
		}

		if(keyboard.down("H") || H_pressed == true)
		{
			if(keyboard.down("H")){
				beganBackChecker = 0;
				beganRightChecker = 0;
			}
			H_pressed = true;
			console.log("H_pressed");
			resetKnight();
			knightIsMovingUp = true;
			moveUp(name);

			if(UP_done == true)
			{
				console.log("UP_done");
				resetKnight();
				knightIsMovingRight = true;
				beganRightChecker++;
				if(beganRightChecker == 1){
					beganRight = true;
				}
				moveRight(name, 2);

				if(RIGHT_done == true)
				{
					console.log("RIGHT_done");
					resetKnight();
					knightIsMovingBack = true;
					beganBackChecker++;
					if(beganBackChecker == 1){
						beganBack = true;
					}
					moveBack(name, 1);

					if(BACK_done == true)
					{
						console.log("BACK_done");
						resetKnight();
						knightIsMovingDown = true;
						moveDown(name);
						if(DOWN_done == true){
							resetKnight();
							resetDones();
							resetPresses();
						}
					}
				}
			}
		}

		if(keyboard.down("F") || F_pressed == true)
		{
			if(keyboard.down("F")){
				beganBackChecker = 0;
				beganLeftChecker = 0;
			}
			F_pressed = true;
			console.log("F_pressed");
			resetKnight();
			knightIsMovingUp = true;
			moveUp(name);

			if(UP_done == true)
			{
				console.log("UP_done");
				resetKnight();
				knightIsMovingBack = true;
				beganBackChecker++;
				if(beganBackChecker == 1){
					beganBack = true;
				}
				moveBack(name, 2);

				if(BACK_done == true)
				{
					console.log("BACK_done");
					resetKnight();
					knightIsMovingLeft = true;
					beganLeftChecker++;
					if(beganLeftChecker == 1){
						beganLeft = true;
					}
					moveLeft(name, 1);

					if(LEFT_done ==  true)
					{
						console.log("LEFT_done");
						resetKnight();
						knightIsMovingDown = true;
						moveDown(name);
						if(DOWN_done == true){
							resetKnight();
							resetDones();
							resetPresses();
						}
					}
				}

			}
		}

		if(keyboard.down("G") || G_pressed == true)
		{
			if(keyboard.down("G")){
				beganBackChecker = 0;
				beganRightChecker = 0;
			}
			G_pressed = true;
			console.log("G_pressed");
			resetKnight();
			knightIsMovingUp = true;
			moveUp(name);

			if(UP_done == true)
			{
				console.log("UP_done");
				resetKnight();
				knightIsMovingBack = true;
				beganBackChecker++;
				if(beganBackChecker == 1){
					beganBack = true;
				}
				moveBack(name, 2);

				if(BACK_done == true)
				{
					console.log("BACK_done");
					resetKnight();
					knightIsMovingRight = true;
					beganRightChecker++;
					if(beganRightChecker == 1){
						beganRight = true;
					}
					moveRight(name, 1);

					if(RIGHT_done == true)
					{
						console.log("RIGHT_done");
						resetKnight();
						knightIsMovingDown = true;
						moveDown(name);
						if(DOWN_done == true){
							resetKnight();
							resetDones();
							resetPresses();
						}
					}
				}
			}
		}
	}

	function towerMovement(name){
		keyboard.update();

		// --------- Bokštas juda į PRIEKĮ -----------
		if(keyboard.down("up") ||UP_pressed == true)
		{
			if(keyboard.down("up")){
				beganStraightChecker = 0;
			}
			UP_pressed = true;
			console.log("UP_pressed");
			resetTower();
			towerIsMovingStraight = true;
			beganStraightChecker++;
			if(beganStraightChecker == 1){
				beganStraight = true;
			}
			moveStraight(name, 1);

			if(STRAIGHT_done == true)
			{
				resetTower();
				resetDones();
				resetPresses();
			}
		}

		// --------- Bokštas juda ATGAL -----------
		if(keyboard.down("down") || DOWN_pressed == true)
		{
			if(keyboard.down("down")){
				beganBackChecker = 0;
			}
			DOWN_pressed = true;
			console.log("DOWN_pressed");
			resetTower();
			towerIsMovingBack = true;
			beganBackChecker++;
			if(beganBackChecker == 1){
				beganBack = true;
			}
			moveBack(name, 1);
			if(BACK_done == true)
			{
				resetTower();
				resetDones();
				resetPresses();
			}
		}

		// --------- Bokštas juda į DEŠINĘ -----------
		if(keyboard.down("right") || RIGHT_pressed == true)
		{
			if(keyboard.down("right")){
				beganRightChecker = 0;
			}
			RIGHT_pressed = true;
			console.log("RIGHT_pressed");
			resetTower();
			towerIsMovingRight = true;
			beganRightChecker++;
			if(beganRightChecker == 1){
				beganRight = true;
			}
			moveRight(name, 1);

			if(RIGHT_done == true)
			{
				resetTower();
				resetDones();
				resetPresses();
			}
		}

		// --------- Bokštas juda į KAIRĘ -----------
		if(keyboard.down("left") || LEFT_pressed == true)
		{
			if(keyboard.down("left")){
				beganLeftChecker = 0;
			}
			LEFT_pressed = true;
			console.log("LEFT_pressed");
			resetTower();
			towerIsMovingLeft = true;
			beganLeftChecker++;
			if(beganLeftChecker == 1){
				beganLeft = true;
			}
			moveLeft(name, 1);

			if(LEFT_done == true)
			{
				resetTower();
				resetDones();
				resetPresses();
			}
		}
	}

	function pawnMovement(name){
		keyboard.update();

		// --------- Pėstininkas juda į PRIEKĮ -----------
		if(keyboard.down("shift") || TWO_pressed == true)
		{
			if(keyboard.down("shift")){
				firstTime++;
			}
			console.log("TWO_pressed");

			if(firstTime == 1){
				TWO_pressed = true;
				console.log("TWO_pressed");
				resetPawn();
				pawnIsMovingStraight = true;
				beganStraightChecker++;
				if(beganStraightChecker == 1){
					beganStraight = true;
				}
				moveStraight(name, 2);
				if(STRAIGHT_done == true)
				{
					resetPawn();
					resetDones();
					resetPresses();
				}
			}
		}
		if(keyboard.down("up") || ONE_pressed == true){

			if(keyboard.down("up")){
				beganStraightChecker = 0;
				firstTime++;
			}
			ONE_pressed = true;
			console.log("ONE_pressed");
			resetPawn();
			pawnIsMovingStraight = true;
			beganStraightChecker++;
			if(beganStraightChecker == 1){
				beganStraight = true;
			}
			moveStraight(name, 1);
			if(STRAIGHT_done == true)
			{
				resetPawn();
				resetDones();
				resetPresses();
			}
		}

		// --------- Pėstininkas juda ATGAL -----------
		if(keyboard.down("down") || DOWN_pressed == true)
		{
			if(keyboard.down("down")){
				beganBackChecker = 0;
			}
			DOWN_pressed = true;
			console.log("DOWN_pressed");
			resetPawn();
			pawnIsMovingBack = true;
			beganBackChecker++;
			if(beganBackChecker == 1){
				beganBack = true;
			}
			moveBack(name, 1);
			if(BACK_done == true)
			{
				resetPawn();
				resetDones();
				resetPresses();
			}
		}
	}


	function resetKnight(){
		knightIsMovingUp = false;
		knightIsMovingDown = false;
		knightIsMovingStraight = false;
		knightIsMovingBack = false;
		knightIsMovingLeft = false;
		knightIsMovingRight = false;
	}

	function resetTower(){
		towerIsMovingUp = false;
		towerIsMovingDown = false;
		towerIsMovingStraight = false;
		towerIsMovingBack = false;
		towerIsMovingLeft = false;
		towerIsMovingRight = false;
	}

	function resetPawn(){
		pawnIsMovingUp = false;
		pawnIsMovingDown = false;
		pawnIsMovingStraight = false;
		pawnIsMovingBack = false;
		pawnIsMovingLeft = false;
		pawnIsMovingRight = false;
	}

	function resetPresses(){
		R_pressed = false;
		T_pressed = false;
		E_pressed = false;
		Y_pressed = false;
		D_pressed = false;
		H_pressed = false;
		F_pressed = false;
		G_pressed = false;
		UP_pressed = false;
		DOWN_pressed = false;
		SPACE_pressed = false;
		LEFT_pressed = false;
		RIGHT_pressed = false;
		ONE_pressed = false;
		TWO_pressed = false;
	}

	function resetDones(){
		UP_done = false;
		STRAIGHT_done = false;
		LEFT_done = false;
		DOWN_done = false;
		RIGHT_done = false;
		BACK_done = false;
	}

	function moveUp(name){
		var step = 0.04;
		var figure = scene.getObjectByName(name);
		//camera.lookAt(figure.position);
		//console.log(figure.position.y);

		if(name == "Žirgas"){
			if(figure.position.y < 6 && knightIsMovingUp == true){
				figure.position.y += 4*step;
			}
			else{
				knightIsMovingUp = false;
				UP_done = true;
			}
		}

		if(name == "Bokštas"){
			if(figure.position.y < 6 && towerIsMovingUp == true){
				figure.position.y += 4*step;
				//console.log(figure.position.y);
			}
			else{
				towerIsMovingUp = false;
				UP_done = true;
			}
		}
		//console.log(figure.position.y);
	}

	var cnt =0;
	function moveDown(name){
		var step = 0.04;
		var figure = scene.getObjectByName(name);
		//camera.lookAt(figure.position);
		if(name == "Žirgas"){
			if(figure.position.y > -1.2 && knightIsMovingDown == true){
				figure.position.y -= 4*step;
			}
			else{
				knightIsMovingDown = false;
				DOWN_done = true;
			}
		}
		if(name == "Bokštas"){
			if(figure.position.y > -0.00001 && towerIsMovingDown == true){
				figure.position.y -= 4*step;

				console.log(figure.position.y);
				cnt++;
				console.log(cnt);
			}
			else{

				towerIsMovingDown = false;
				DOWN_done = true;
				console.log("DOWN_done = true");
			}
		}
	}

	function moveStraight(name, k){
		var step = 0.04;
		var figure = scene.getObjectByName(name);
		//camera.lookAt(figure.position);
		if(name == "Žirgas"){
			if(beganStraight == true){
				limit_S = figure.position.x + 4*k;
				beganStraight = false;
			}
			if(figure.position.x < limit_S && knightIsMovingStraight == true){
				figure.position.x += 4*step;
			}
			else{
				knightIsMovingStraight = false;
				STRAIGHT_done = true;
			}
		}
		if(name == "Bokštas"){
			if(beganStraight == true){
				limit_S = figure.position.x + 4*k;
				beganStraight = false;
			}
			if(figure.position.x < limit_S && towerIsMovingStraight == true){
				figure.position.x += 4*step;
			}
			else{
				towerIsMovingStraight = false;
				STRAIGHT_done = true;
			}
		}
		if(name == "Pėstininkas"){
			if(beganStraight == true){
				limit_S = figure.position.x + 4*k;
				beganStraight = false;
			}
			if(figure.position.x < limit_S && pawnIsMovingStraight == true){
				figure.position.x += 4*step;
			}
			else{
				pawnIsMovingStraight = false;
				STRAIGHT_done = true;
			}
		}
	}

	function moveBack(name, k){
		var step = 0.04;
		var limit;
		var figure = scene.getObjectByName(name);
		//camera.lookAt(figure.position);
		if(name == "Žirgas"){
			if(beganBack == true){
				limit_B = figure.position.x + (-4*k);
				beganBack = false;
			}
			if(figure.position.x > limit_B && knightIsMovingBack == true){
				figure.position.x -= 4*step;
			}
			else{
				knightIsMovingBack = false;
				BACK_done = true;
			}
		}
		if(name == "Bokštas"){
			if(beganBack == true){
				limit_B = figure.position.x + (-4*k);
				beganBack = false;
			}
			if(figure.position.x > limit_B && towerIsMovingBack == true){
				figure.position.x -= 4*step;
			}
			else{
				towerIsMovingBack = false;
				BACK_done = true;
			}
		}
		if(name == "Pėstininkas"){
			if(beganBack == true){
				limit_B = figure.position.x + (-4*k);
				beganBack = false;
			}
			if(figure.position.x > limit_B && pawnIsMovingBack == true){
				figure.position.x -= 4*step;
			}
			else{
				pawnIsMovingBack = false;
				BACK_done = true;
			}
		}
	}

	function moveLeft(name, k){
		var step = 0.04;
		var figure = scene.getObjectByName(name);
		//camera.lookAt(figure.position);
		if(name == "Žirgas"){
			if(beganLeft == true){
				limit_L = figure.position.z + (-4*k);
				beganLeft = false;
			}
			if(figure.position.z > limit_L && knightIsMovingLeft == true){
				figure.position.z -= 4*step;
			}
			else{
				knightIsMovingLeft = false;
				LEFT_done = true;
			}
		}
		if(name == "Bokštas"){
			if(beganLeft == true){
				limit_L = figure.position.z + (-4*k);
				beganLeft = false;
			}
			if(figure.position.z > limit_L && towerIsMovingLeft == true){
				figure.position.z -= 4*step;
			}
			else{
				towerIsMovingLeft = false;
				LEFT_done = true;
			}
		}
	}

	function moveRight(name, k){
		var step = 0.04;
		var figure = scene.getObjectByName(name);
		//camera.lookAt(figure.position);
		if(name == "Žirgas"){
			if(beganRight == true){
				limit_R = figure.position.z + 4*k;
				beganRight = false;
			}
			if(figure.position.z < limit_R && knightIsMovingRight == true){
				figure.position.z += 4*step;
			}
			else{
				knightIsMovingRight = false;
				RIGHT_done = true;
			}
		}
		if(name == "Bokštas"){
			if(beganRight == true){
				limit_R = figure.position.z + 4*k;
				beganRight = false;
			}
			if(figure.position.z < limit_R && towerIsMovingRight == true){
				figure.position.z += 4*step;
			}
			else{
				towerIsMovingRight = false;
				RIGHT_done = true;
			}
		}
	}

	function render() {
		if(pav == "Pėstininkas")
			pawnMovement("Pėstininkas");

		if(pav == "Žirgas")
			knightMovement("Žirgas");
		if(knightIsMovingUp == true)
			moveUp("Žirgas");
		if(knightIsMovingDown == true)
			moveDown("Žirgas");

		if(pav == "Bokštas")
			towerMovement("Bokštas");
		if(towerIsMovingUp == true)
			moveUp("Bokštas");
		if(towerIsMovingDown == true)
			moveDown("Bokštas");


		if(c3){
			var dist;
			var figure = scene.getObjectByName("Karalienė");
			camera3.lookAt(new THREE.Vector3(-14, 8, -2));
			camera3.fov = dollyZoomCount;


			dist = (camera3.position.z / (2*Math.tan(0.5*camera3.fov)));

			camera3.position.x = figure.position.x - dist;
			//camera3.position.z = camera3.position.x * (2*Math.tan(0.5*camera3.fov));
			camera3.updateProjectionMatrix();
			console.log(camera3.position);
			renderer.render(scene, camera3);

		} else if(c2 ){
			var figure = scene.getObjectByName(pav);

			camera2.lookAt(figure.position);
			renderer.render(scene, camera2);
		} else{
			console.log("KAMERA 1");
			camera1.lookAt(scene.position);
			camera1.fov = zoomCount;

			camera1.updateProjectionMatrix();
			document.body.appendChild(renderer.domElement);
			$("#WebGL-output").append(renderer.domElement);
			camControl = new THREE.TrackballControls( camera1, renderer.domElement );
			renderer.render(scene, camera1);
			//camControl.update();
		}
		requestAnimationFrame(render);



		//renderer.render(scene, camera1);
		//requestAnimationFrame(render);
		//camControl.update();
	}

	window.onload = init;

</script>
</body>
</html>
